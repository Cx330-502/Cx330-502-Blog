---
title: UE源码从编译到安卓打包
date: 2023-09-14 10:16:40
updated: 2023-09-14 10:16:45
tags:
  - UE5
  - UE4
  - 游戏引擎
  - Android
  - 游戏客户端
  - Bugs
categories: 游戏客户端
keywords:
  - UE5
  - UE4
  - 游戏客户端
  - Bugs
description: UE4.27.2和UE5.2.1从源码下载到编译，以及UE5.2.1的安卓打包
top_img:
comments:
cover:
toc:
toc_number:
toc_style_simple:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:
abcjs:
---

# 下载并编译源码

官方文档在这里：[UE-4.27](https://docs.unrealengine.com/4.27/zh-CN/ProgrammingAndScripting/ProgrammingWithCPP/DownloadingSourceCode/) 和 [UE-5.2](https://docs.unrealengine.com/5.2/zh-CN/downloading-unreal-engine-source-code/)


## 下载UE源码

### 绑定 Epic


为了下载 UE 的源码，我们必须先将 Github 和 Epic 账号进行绑定，进入[虚幻官网](https://www.unrealengine.com/zh-CN/ue-on-github)，用 Epic 账号登陆后，即可进入账户控制板绑定 Github 账号。

授权后会收到一封 Github 的邮件，同意加入 EpicGames 组织即可完成 Github 和 Epic 账号的绑定。

![绑定流程页面](/files_/pics/post_pics/2023-09/2023-09-14-UE编译打包/pic1.png)

### 下载源代码

进入[虚幻引擎的仓库](https://github.com/EpicGames/UnrealEngine)页面，可以看到截至更新为止共有69个分支，包括本文中将要下载的 5.2 、4.27等。

接下来是**重点**（敲黑板）：

1. **不要直接clone仓库！！！**
2. **不要直接下载某个分支！！！**

对这两点解释一下：

首先是千万不要 clone ，因为总共有69个分支，几十个版本，而事实上我们只需要两个分支，完全不需要把整个仓库全都clone到本地，整个仓库clone下来有27G，而其中25G都是我们不会使用的分支存贮在 `.git` 文件夹中。

其次就是不要直接在源码界面进行下载，因为源码界面的分支未必是发行版本，比如 4.27 的分支就有 `4.27-chaos` 、`4.27-plus` 、`4.27` 三种，鬼知道改下哪个，有一种手机厂商卷后缀的美感(bushi)。

因此，我们应该点开旁边的 release ，这里有所有 Unreal Engine 的发行版本。笔者在下载时选择了 5.2.1 和 4.27.2 两个版本，因为 5.3 刚出没几天可能有bug，而5.2.1已经是长期的稳定版本；4.27.2则是 UE4 最成熟的版本。

等待下载完成，我们进入下一步——编译。

## 编译 UE 源码

在解压下载的源代码时，同样有两个**重点**：

1. 别把文件夹藏得太深
2. 文件夹的名字不要太长，尽量精简，如UE4.27.2即可
3. 路径尽量不要有中文字符

原因是UE源代码的文件夹同样很深，如果上述1、2两点没注意的话，很有可能会报 `路径长度超过260个字符` 的错误；中文路径的话，只能说尽可能避免吧，防止出一些奇怪的问题。

### 下载依赖

我们先对 UE4.27.2 的源码进行操作，首先安装依赖： Windows 系统运行源码文件夹下的 `Setup.bat` ，Linux 系统运行 `Setup.sh` ， MacOS 系统运行 `Setup.command` （后续要运行的命令都会按照系统进行区分，本文将以windows作为实例，此后不再赘述）。

 然后就会发现 ... 报错了！

报错内容应该是这样的：

```shell
Checking dependencies...
Updating dependencies:   0% (0/64293)...
Failed to download 'http://cdn.unrealengine.com/dependencies/UnrealEngine-18298425/0107275f6001142a756fd31da3aef73c3cf3e703': 远程服务器返回错误: (403) 已禁止。 (WebException)
```

咋啥都没干就开始报错了呢？！

放心，这不是你的问题。

我们回到刚才 Github 上的 release 界面，会发现在 `Unreal Engine 5.2` 之前的发行版本，都有三个文件，除了两个压缩包外，还有一个 `Commit.gitdeps.xml` 文件，仔细看看标注了 IMPORTANT 的说明：

> Per a previous announcement on [GitHub Disruption](https://forums.unrealengine.com/t/upcoming-disruption-of-service-impacting-unreal-engine-users-on-github/1155880). To remedy related download errors, a new Commit.gitdeps.xml file is attached to this release as an Asset. Please replace the existing [Engine/Build/Commit.gitdeps.xml](https://github.com/EpicGames/UnrealEngine/releases/download/5.0.1-release/Commit.gitdeps.xml) with the attached file.

也就是说，这个下载 bug 是官方知道的，我们要把 release 界面的 `Commit.gitdeps.xml` 文件下载下来，替换掉 [Engine/Build/Commit.gitdeps.xml](https://github.com/EpicGames/UnrealEngine/releases/download/5.0.1-release/Commit.gitdeps.xml) 处的同名文件即可解决。

再运行 `Setup.bat` ，下载正常进行，安心等待下载完成即可。

UE5.2.1 直接运行 `Setup.bat` 即可。

### 创建引擎项目文件

运行 `GenerateProjectFiles.bat` 来为引擎创建项目文件。这个过程应该不超过一分钟即可完成。

UE4.27.2 会生成一个 `UE4.sln` 文件；UE5.2.1 会生成一个 `UE5.sln` 

### 编译构建

双击上一步生成了 `.sln` 文件，用 `visual studio` 打开（我一开始用的是 Rider ，但是反复失败 ... 最后还是用上了 `visual studio`）

将构建模式设置为 `Development Editor` 和 `Win64` ，然后右键这里的 `UE5` 或 `UE4` ，选择生成即可。

![编译页面](/files_/pics/post_pics/2023-09/2023-09-14-UE编译打包/pic2.png)

时间方面，我编译 UE4.27.2 用了一小时多， UE5.2.1 用了四个多小时，电脑CPU是 i7-10875H ，16G 内存，全程 CPU 和 内存都是百分百占用。建议把电脑放那编译自己该干啥干啥。

编译一个多小时尚能接受，但是如果编译完一个小时发现最后有个报错导致编译失败😏😏😏

咳咳，我先提前说一下最有可能出现的几个bug：

+ 路径超过260个字符（谁让你不听我前面说的）
+ C4668 没有将”_NOEXCEPT_TYPES_SUPPORTED~定义为预处理宏,用0"替换"#if/#elif（大概是这个吧，不太记得了）
+ 错误 MSB3073 命令"..\\..\\Build\\BatchFiles\\Build.bat - Target = ..."

后面两个原因是类似的，主要是 MSB3073 这个报错，我参考这篇[博客](https://blog.csdn.net/qq_58814201/article/details/131721685)后成功解决了，原因是 visual studio 没有下载相关内容。

打开 Visual Studio Installer (如果VS用的比较少的话，可以在开始菜单栏里搜索一下就能找到)，点击修改-单个组件-搜索unreal，会发现没有安装 `Unreal Engine 安装程序` ，把它勾选上然后下载，重新进行编译就可以了。

### 启动引擎

还是在解决方案资源管理器中右键刚才的 Engine-UE5 ，首先将它 *设为启动项目* ，
